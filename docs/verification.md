# 検証手順書

## 概要

本ドキュメントは、GitHubダッシュボードカスタマイズChrome拡張機能の開発時の検証手順を記載する。

## 前提条件

- Chromeブラウザがインストールされていること
- Node.jsがインストールされていること（ビルドツールを使用する場合）
- GitHubアカウントとPersonal Access Token（PAT）を取得済みであること

## 開発環境のセットアップ

### 1. リポジトリのクローン

```bash
git clone https://github.com/a2chub/github_chrome_plugin.git
cd github_chrome_plugin
```

### 2. 依存関係のインストール

```bash
npm install
# または
yarn install
```

### 3. ビルド（ビルドツールを使用する場合）

```bash
npm run build
# または
yarn build
```

## Chrome拡張機能の読み込み

### 1. 拡張機能管理ページを開く

1. Chromeブラウザを開く
2. アドレスバーに `chrome://extensions/` を入力してEnter
3. または、メニュー → その他のツール → 拡張機能

### 2. デベロッパーモードを有効化

1. 拡張機能管理ページの右上にある「デベロッパーモード」トグルをONにする

### 3. 拡張機能を読み込む

1. 「パッケージ化されていない拡張機能を読み込む」ボタンをクリック
2. プロジェクトのルートディレクトリ（`github_chrome_plugin`）を選択
   - ビルドツールを使用する場合: `dist/` ディレクトリを選択
   - ビルドツールを使用しない場合: プロジェクトルートを選択

### 4. 読み込み確認

- 拡張機能一覧に「GitHub Dashboard Customizer」が表示されることを確認
- エラーが表示されていないことを確認

## 開発中の更新手順

### コード変更後の反映

1. コードを修正する
2. ビルドツールを使用している場合: `npm run build` を実行
3. 拡張機能管理ページ（`chrome://extensions/`）を開く
4. 対象の拡張機能の「更新」ボタン（🔄）をクリック
5. または、拡張機能を一度削除して再度読み込む

### ホットリロード（開発時）

ビルドツールがホットリロードに対応している場合、自動的に変更が反映される。

## デバッグ方法

### 1. Background Script（Service Worker）のデバッグ

1. 拡張機能管理ページ（`chrome://extensions/`）を開く
2. 対象の拡張機能の「service worker」リンクをクリック
3. 開発者ツールが開き、コンソールでログやエラーを確認できる
4. ブレークポイントを設定してデバッグ可能

**注意**: Service Workerは一定時間で自動的に停止するため、長時間のデバッグには注意が必要。

### 2. Content Scriptのデバッグ

1. GitHubダッシュボードページ（`https://github.com`）を開く
2. ページ上で右クリック → 「検証」を選択
3. 開発者ツールが開く
4. 「Console」タブでContent Scriptのログを確認
5. 「Sources」タブでContent Scriptのソースコードを確認・デバッグ可能

**注意**: Content Scriptはページのコンテキストで実行されるため、ページの開発者ツールでデバッグする。

### 3. Options Page（設定画面）のデバッグ

1. 拡張機能のアイコンを右クリック
2. 「オプション」を選択
3. Options Pageが開いたら、ページ上で右クリック → 「検証」を選択
4. 開発者ツールが開き、コンソールでログやエラーを確認できる

### 4. メッセージパッシングのデバッグ

- Background ScriptとContent Script間のメッセージを確認するには、両方の開発者ツールのコンソールを確認
- `chrome.runtime.sendMessage` と `chrome.runtime.onMessage` のログを追加して確認

## 機能別検証手順

### Phase 1: 基盤構築の検証

#### 1.1 拡張機能の読み込み確認

- [ ] Chrome拡張機能管理ページで拡張機能が読み込まれる
- [ ] エラーが表示されない
- [ ] 拡張機能のアイコンが表示される

#### 1.2 Content Scriptの注入確認

1. GitHubダッシュボードページ（`https://github.com`）を開く
2. 開発者ツールのコンソールで以下を実行:
   ```javascript
   // Content Scriptが注入されているか確認
   console.log('Content Script loaded');
   ```
3. または、Content Scriptに `console.log` を追加して確認

#### 1.3 Background Scriptの動作確認

1. Service Workerの開発者ツールを開く
2. コンソールでログが出力されることを確認
3. エラーが発生していないことを確認

#### 1.4 Options Pageの表示確認

1. 拡張機能のアイコンを右クリック → 「オプション」を選択
2. Options Pageが正常に表示されることを確認
3. エラーが発生していないことを確認

### Phase 2: 設定画面とDOM操作基盤の検証

#### 2.1 設定の保存・読み込み確認

1. Options Pageを開く
2. 設定を変更する（チェックボックス、並び順等）
3. 「保存」ボタンをクリック
4. Options Pageを閉じて再度開く
5. 設定が保存されていることを確認

#### 2.2 DOM操作の確認

1. GitHubダッシュボードページを開く
2. 開発者ツールの「Elements」タブでDOMを確認
3. 設定に基づいてDOMが変更されていることを確認
4. 既存要素が削除/非表示になっていることを確認

#### 2.3 設定変更の即座反映確認

1. Options Pageで設定を変更
2. GitHubダッシュボードページに戻る
3. 設定変更が即座に反映されることを確認

### Phase 3: GitHub API統合の検証

#### 3.1 PAT認証の確認

1. Options PageでPATを入力
2. 「保存」ボタンをクリック
3. PATの有効性が検証されることを確認
4. 無効なPATの場合、エラーメッセージが表示されることを確認

#### 3.2 API呼び出しの確認

1. Service Workerの開発者ツールを開く
2. 「Network」タブでGitHub APIへのリクエストを確認
3. 認証ヘッダーが正しく設定されていることを確認
4. レスポンスが正常に返ってくることを確認

#### 3.3 キャッシュ機能の確認

1. 初回API呼び出しを確認
2. 2回目の呼び出しでキャッシュが使用されることを確認
3. キャッシュのTTLが適切に設定されていることを確認

#### 3.4 レートリミット管理の確認

1. 多数のAPIリクエストを送信
2. レートリミット情報が正しく取得されることを確認
3. レートリミット接近時に警告が表示されることを確認

### Phase 4: コア機能実装の検証

#### 4.1 Organization別リポジトリリストの確認

1. GitHubダッシュボードページを開く
2. Organization別にリポジトリがグループ化されていることを確認
3. リポジトリ名、更新日時が正しく表示されることを確認
4. リポジトリへのリンクが正常に動作することを確認

#### 4.2 メンションされたIssueリストの確認

1. GitHubダッシュボードページを開く
2. メンションされたIssueが一覧表示されることを確認
3. Issueの状態（オープン/クローズ）が正しく表示されることを確認
4. Issueへのリンクが正常に動作することを確認

#### 4.3 更新順プロジェクトサマリーの確認

1. GitHubダッシュボードページを開く
2. プロジェクトが更新順に表示されることを確認
3. プロジェクト情報が正しく表示されることを確認
4. プロジェクトへのリンクが正常に動作することを確認

#### 4.4 データ更新機能の確認

1. 手動更新ボタンをクリック
2. データが更新されることを確認
3. ローディング表示が適切に表示されることを確認
4. 定期的な自動更新が動作することを確認

### Phase 5: Export/Import機能の検証

#### 5.1 Export機能の確認

1. Options Pageを開く
2. 「設定をエクスポート」ボタンをクリック
3. JSONファイルがダウンロードされることを確認
4. ダウンロードしたファイルの内容が正しいことを確認

#### 5.2 Import機能の確認

1. Options Pageを開く
2. 現在の設定を確認
3. 「設定をインポート」ボタンをクリック
4. エクスポートしたJSONファイルを選択
5. 設定が正しくインポートされることを確認
6. 設定が即座に反映されることを確認

#### 5.3 エラーハンドリングの確認

1. 不正なJSONファイルをインポートしようとする
2. 適切なエラーメッセージが表示されることを確認
3. 設定が変更されないことを確認

### Phase 6: エラーハンドリングと最適化の検証

#### 6.1 APIエラーの確認

1. 無効なPATを設定
2. API呼び出し時に401エラーが発生することを確認
3. 適切なエラーメッセージが表示されることを確認

2. ネットワークを切断
3. ネットワークエラーが適切に処理されることを確認
4. エラーメッセージが表示されることを確認

#### 6.2 パフォーマンスの確認

1. ページ読み込み時間を測定
2. 拡張機能による影響が500ms以内であることを確認
3. DOM操作が効率的に行われていることを確認

#### 6.3 ユーザー体験の確認

1. ローディング表示が適切に表示されることを確認
2. エラーメッセージが分かりやすいことを確認
3. 空状態が適切に表示されることを確認

## トラブルシューティング

### 拡張機能が読み込めない

- `manifest.json` の構文エラーを確認
- コンソールでエラーメッセージを確認
- ファイルパスが正しいか確認

### Content Scriptが動作しない

- GitHubダッシュボードページで正しく動作しているか確認
- `manifest.json` の `content_scripts` 設定を確認
- ページの読み込みタイミングを確認（DOMContentLoaded等）

### Background Scriptが動作しない

- Service Workerの開発者ツールでエラーを確認
- `manifest.json` の `background` 設定を確認
- Service Workerが停止していないか確認

### API呼び出しが失敗する

- PATが正しく設定されているか確認
- ネットワーク接続を確認
- APIレートリミットに達していないか確認
- 開発者ツールのNetworkタブでリクエストを確認

### 設定が保存されない

- Chrome Storage APIの権限を確認
- ストレージの容量制限を確認
- コンソールでエラーを確認

## テスト環境

### 推奨環境

- **Chrome**: 最新版（Manifest V3対応）
- **OS**: macOS, Windows, Linux（いずれも対応）

### テストブラウザ

- Chrome（必須）
- Edge（Chromiumベースのため動作する可能性が高い）

## 継続的な検証

### 開発中の検証

- 各機能実装後に上記の検証手順を実行
- 問題があれば即座に対応

### リリース前の検証

- すべてのPhaseの検証手順を実行
- エッジケースのテスト
- パフォーマンステスト
- セキュリティテスト

## 参考資料

- [Chrome拡張機能の開発ドキュメント](https://developer.chrome.com/docs/extensions/)
- [Manifest V3移行ガイド](https://developer.chrome.com/docs/extensions/mv3/intro/)
- [GitHub API ドキュメント](https://docs.github.com/ja/rest)

