# 実装計画

## 概要

本ドキュメントは、GitHubダッシュボードカスタマイズChrome拡張機能の実装計画をPhase別に記載する。各Phaseは必要性の高い順に実装を進める。

## Phase 1: 基盤構築

### 目的
Chrome拡張機能の基本構造を構築し、開発環境を整備する。

### タスク

#### 1.1 プロジェクト初期化
- [ ] `package.json`の作成
- [ ] TypeScript設定（`tsconfig.json`）
- [ ] ビルドツールの設定（webpack/vite/esbuild）
- [ ] ESLint/Prettierの設定
- [ ] `.gitignore`の確認・更新

#### 1.2 Manifest V3の作成
- [ ] `manifest.json`の作成
  - 拡張機能の基本情報（name, version, description）
  - permissions設定
  - content_scripts設定
  - background service_worker設定
  - options_page設定
  - icons設定

#### 1.3 基本ファイル構造の作成
- [ ] `src/background/service-worker.ts`の作成
- [ ] `src/content/content-script.ts`の作成
- [ ] `src/options/options.html`の作成
- [ ] `src/types/`ディレクトリの作成
- [ ] `src/utils/`ディレクトリの作成

#### 1.4 型定義の作成
- [ ] `src/types/settings.ts` - 設定データの型定義
- [ ] `src/types/api.ts` - APIレスポンスの型定義
- [ ] `src/types/messages.ts` - メッセージパッシングの型定義

#### 1.5 基本機能の実装
- [ ] Chrome Storage APIのラッパー実装（`src/utils/storage.ts`）
- [ ] メッセージパッシングの基本実装
- [ ] Content Scriptの基本注入確認

### 完了基準
- 拡張機能がChromeに読み込める
- Content ScriptがGitHubダッシュボードページに注入される
- Background Scriptが動作する
- Options Pageが開ける

### 見積もり時間
2-3日

---

## Phase 2: 設定画面とDOM操作基盤

### 目的
ユーザーがカスタマイズできる設定画面を実装し、DOM操作の基盤を構築する。

### タスク

#### 2.1 Options Pageの実装
- [ ] `src/options/options.html`の作成
  - 認証設定セクション
  - レイアウト設定セクション
  - 並び順セクション
  - Export/Importセクション
- [ ] `src/options/options.css`の作成
  - レスポンシブデザイン
  - GitHub風のスタイル
- [ ] `src/options/options.ts`の実装
  - 設定の読み込み・保存
  - PAT入力・保存機能
  - チェックボックスによる表示/非表示設定
  - ドラッグ&ドロップによる並び順設定

#### 2.2 設定管理機能の実装
- [ ] 設定のデフォルト値定義
- [ ] 設定のバリデーション実装
- [ ] 設定変更の即座反映機能

#### 2.3 DOM操作基盤の実装
- [ ] `src/content/dom-manipulator.ts`の実装
  - 既存要素の削除機能
  - 既存要素の非表示機能
  - 新規要素の追加機能
- [ ] `src/content/layout-renderer.ts`の実装
  - レイアウトテンプレートの定義
  - レイアウトの適用機能

#### 2.4 メッセージパッシングの拡張
- [ ] 設定変更通知の実装
- [ ] Content Scriptへの設定送信機能

### 完了基準
- Options Pageで設定を変更できる
- 設定がStorageに保存される
- Content Scriptが設定を読み込んでDOMを操作できる
- 設定変更が即座に反映される

### 見積もり時間
3-4日

---

## Phase 3: GitHub API統合（PAT認証）

### 目的
GitHub APIとの通信機能を実装し、認証管理を行う。

### タスク

#### 3.1 APIクライアントの実装
- [ ] `src/background/api-client.ts`の実装
  - Fetch APIを使用したHTTPクライアント
  - 認証ヘッダーの追加
  - エラーハンドリング
  - リトライ機能（指数バックオフ）

#### 3.2 認証管理の実装
- [ ] PATの保存・取得機能
- [ ] PATの有効性検証機能
- [ ] 認証エラー時の処理

#### 3.3 キャッシュ管理の実装
- [ ] `src/background/cache-manager.ts`の実装
  - キャッシュの保存・取得
  - TTL（Time To Live）の管理
  - キャッシュの無効化

#### 3.4 レートリミット管理の実装
- [ ] APIレートリミットの監視
- [ ] レートリミット接近時の警告
- [ ] レートリミット超過時の処理

#### 3.5 基本API呼び出しの実装
- [ ] `GET /user` - ユーザー情報取得
- [ ] `GET /user/orgs` - Organization一覧取得
- [ ] エラーハンドリングの実装

### 完了基準
- PATを入力して保存できる
- PATの有効性が検証される
- GitHub APIからユーザー情報を取得できる
- APIレスポンスがキャッシュされる
- レートリミットが適切に管理される

### 見積もり時間
4-5日

---

## Phase 4: コア機能実装

### 目的
実際に価値を提供する機能（リポジトリリスト、Issueリスト、プロジェクトサマリー）を実装する。

### タスク

#### 4.1 Organization別リポジトリリストの実装
- [ ] `GET /user/repos` API呼び出しの実装
- [ ] `GET /orgs/{org}/repos` API呼び出しの実装
- [ ] リポジトリデータのOrganization別グループ化
- [ ] 使用頻度・更新日時によるソート機能
- [ ] `src/content/components/repository-list.ts`の実装
  - リポジトリリストの表示
  - リンクの生成
  - 更新日時の表示

#### 4.2 メンションされたIssueリストの実装
- [ ] `GET /issues` API呼び出しの実装（メンションされたIssue取得）
- [ ] Issueデータのフィルタリング（メンションのみ）
- [ ] `src/content/components/issue-list.ts`の実装
  - Issueリストの表示
  - オープン/クローズ状態の表示
  - リポジトリ名とIssueタイトルの表示
  - リンクの生成
  - 更新日時の表示

#### 4.3 更新順プロジェクトサマリーの実装
- [ ] `GET /user/projects` API呼び出しの実装
- [ ] `GET /orgs/{org}/projects` API呼び出しの実装
- [ ] プロジェクトデータの更新日時によるソート
- [ ] `src/content/components/project-summary.ts`の実装
  - プロジェクトサマリーの表示
  - 更新内容のサマリー表示
  - リンクの生成
  - 更新日時の表示

#### 4.4 レイアウト統合
- [ ] 各コンポーネントをレイアウトに統合
- [ ] 設定に基づく表示/非表示の制御
- [ ] 設定に基づく並び順の適用

#### 4.5 データ更新機能の実装
- [ ] 定期的なデータ更新機能（ポーリング）
- [ ] 手動更新機能（リフレッシュボタン）
- [ ] 更新中のローディング表示

### 完了基準
- Organization別にリポジトリリストが表示される
- メンションされたIssueリストが表示される
- 更新順のプロジェクトサマリーが表示される
- 各要素が設定に従って表示/非表示される
- データが定期的に更新される

### 見積もり時間
5-7日

---

## Phase 5: Export/Import機能

### 目的
設定をエクスポート/インポートできる機能を実装し、設定の移植性を向上させる。

### タスク

#### 5.1 Export機能の実装
- [ ] 設定データのJSONシリアライズ
- [ ] JSONファイルのダウンロード機能
- [ ] ファイル名の生成（タイムスタンプ付き）

#### 5.2 Import機能の実装
- [ ] JSONファイルの読み込み機能
- [ ] JSONデータのバリデーション
- [ ] 設定データのデシリアライズ
- [ ] 設定の適用機能

#### 5.3 UIの実装
- [ ] Exportボタンの実装
- [ ] Importボタンの実装
- [ ] ファイル選択ダイアログの実装
- [ ] 成功/エラーメッセージの表示

#### 5.4 エラーハンドリング
- [ ] 不正なJSON形式の検証
- [ ] 設定データの互換性チェック
- [ ] エラーメッセージの表示

### 完了基準
- 設定をJSONファイルとしてエクスポートできる
- JSONファイルから設定をインポートできる
- 設定の移植が正常に動作する
- エラー時に適切なメッセージが表示される

### 見積もり時間
2-3日

---

## Phase 6: エラーハンドリングと最適化

### 目的
エラーハンドリングを強化し、パフォーマンスを最適化する。

### タスク

#### 6.1 エラーハンドリングの強化
- [ ] APIエラーの詳細な処理
  - 401 Unauthorized → PAT再入力要求
  - 403 Forbidden → 権限不足メッセージ
  - 404 Not Found → スキップ
  - 429 Too Many Requests → リトライ待機
  - 500 Server Error → リトライ
- [ ] ネットワークエラーの処理
  - タイムアウト処理（30秒）
  - 接続エラー時のリトライ
- [ ] データエラーの処理
  - JSONパースエラー
  - データ不整合の検証

#### 6.2 パフォーマンス最適化
- [ ] DOM操作の最適化
  - DocumentFragmentの使用
  - 一括DOM操作
  - 必要最小限の再描画
- [ ] キャッシュ戦略の最適化
  - キャッシュTTLの調整
  - キャッシュ無効化の改善
- [ ] API呼び出しの最適化
  - バッチリクエストの検討
  - 並列リクエストの制御

#### 6.3 ユーザー体験の改善
- [ ] ローディング表示の改善
- [ ] エラーメッセージの改善
- [ ] 空状態の表示（データがない場合）
- [ ] 更新ボタンの実装

#### 6.4 ログ機能の実装
- [ ] デバッグログの実装
- [ ] エラーログの実装
- [ ] ログレベルの設定

### 完了基準
- すべてのエラーケースが適切に処理される
- パフォーマンスが最適化されている（ページ読み込み時間への影響が500ms以内）
- ユーザー体験が向上している
- ログが適切に記録される

### 見積もり時間
3-4日

---

## 全体の見積もり時間

| Phase | 見積もり時間 | 累計時間 |
|-------|-------------|---------|
| Phase 1: 基盤構築 | 2-3日 | 2-3日 |
| Phase 2: 設定画面とDOM操作基盤 | 3-4日 | 5-7日 |
| Phase 3: GitHub API統合 | 4-5日 | 9-12日 |
| Phase 4: コア機能実装 | 5-7日 | 14-19日 |
| Phase 5: Export/Import機能 | 2-3日 | 16-22日 |
| Phase 6: エラーハンドリングと最適化 | 3-4日 | 19-26日 |

**合計**: 約19-26日（1人月程度）

## 実装順序の依存関係

```
Phase 1 (基盤構築)
  ↓
Phase 2 (設定画面とDOM操作基盤)
  ↓
Phase 3 (GitHub API統合)
  ↓
Phase 4 (コア機能実装) ← Phase 2, 3の完了が必要
  ↓
Phase 5 (Export/Import機能) ← Phase 2の完了が必要
  ↓
Phase 6 (エラーハンドリングと最適化) ← 全Phaseの完了後に実施
```

## リスクと対策

### リスク1: GitHubのページ構造変更
- **影響**: Content Scriptが動作しなくなる可能性
- **対策**: セレクタの保守、定期的な動作確認

### リスク2: GitHub APIの仕様変更
- **影響**: API呼び出しが失敗する可能性
- **対策**: APIバージョニングの確認、エラーハンドリングの強化

### リスク3: レートリミット超過
- **影響**: API呼び出しが制限される
- **対策**: キャッシュの活用、リクエスト頻度の制御

### リスク4: PATのセキュリティ
- **影響**: トークンが漏洩する可能性
- **対策**: Chrome Storage APIの使用、暗号化の検討

## 次のステップ

1. Phase 1の実装開始
2. 各Phase完了時に動作確認とテスト
3. 問題があれば即座に対応
4. 全Phase完了後に総合テストとデプロイ準備

