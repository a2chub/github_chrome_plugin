# Phase 3: GitHub API統合（PAT認証）

## 概要
GitHub APIとの通信機能を実装し、認証管理を行う。

## 目的
- PATを入力して保存できる
- PATの有効性が検証される
- GitHub APIからユーザー情報を取得できる
- APIレスポンスがキャッシュされる
- レートリミットが適切に管理される

## タスク

### 3.1 APIクライアントの実装
- [ ] `src/background/api-client.ts`の実装
  - Fetch APIを使用したHTTPクライアント
    - GETリクエストの実装
    - 認証ヘッダーの追加
    - リクエストオプションの設定
  - エラーハンドリング
    - HTTPステータスコードの処理
    - エラーレスポンスのパース
  - リトライ機能（指数バックオフ）
    - リトライロジックの実装
    - 最大リトライ回数の設定

### 3.2 認証管理の実装
- [ ] PATの保存・取得機能
  - Storage APIを使用した保存
  - 暗号化の検討（オプション）
- [ ] PATの有効性検証機能
  - `GET /user` APIでトークン検証
  - 検証結果の通知
- [ ] 認証エラー時の処理
  - 401エラー時の処理
  - ユーザーへの通知

### 3.3 キャッシュ管理の実装
- [ ] `src/background/cache-manager.ts`の実装
  - キャッシュの保存・取得
    - Storage APIを使用
    - キー・バリュー形式での保存
  - TTL（Time To Live）の管理
    - タイムスタンプの記録
    - 有効期限のチェック
  - キャッシュの無効化
    - 手動無効化機能
    - 時間ベースの無効化

### 3.4 レートリミット管理の実装
- [ ] APIレートリミットの監視
  - レスポンスヘッダーからの取得
  - レートリミット情報の保存
- [ ] レートリミット接近時の警告
  - 閾値の設定（例: 80%）
  - ユーザーへの通知
- [ ] レートリミット超過時の処理
  - 429エラーの処理
  - リトライ待機時間の計算

### 3.5 基本API呼び出しの実装
- [ ] `GET /user` - ユーザー情報取得
  - APIエンドポイントの実装
  - レスポンスの型定義
  - エラーハンドリング
- [ ] `GET /user/orgs` - Organization一覧取得
  - APIエンドポイントの実装
  - レスポンスの型定義
  - エラーハンドリング
- [ ] エラーハンドリングの実装
  - 各エラーケースの処理
  - エラーメッセージの生成

## 完了基準
- [x] PATを入力して保存できる
- [x] PATの有効性が検証される
- [x] GitHub APIからユーザー情報を取得できる
- [x] APIレスポンスがキャッシュされる
- [x] レートリミットが適切に管理される

## 見積もり時間
4-5日

## 依存関係
- Phase 1の完了が必要

## 関連ドキュメント
- [要件定義書](../requirements.md)
- [設計書](../design.md)
- [実装計画](../implementation-plan.md)
- [GitHub API ドキュメント](https://docs.github.com/ja/rest)

